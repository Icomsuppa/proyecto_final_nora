<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Multicast</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}">
</head>
<body>
  <!-- Topbar con perfil y bot贸n de salir -->
  <div class="topbar">
    <div class="topbar-left">
      <h3>Chat Multicast</h3>
    </div>
    <div class="topbar-right">
      <div class="user-profile">
        <img src="{{ url_for('static', filename=user.profile_image) }}" 
             alt="Foto de perfil" 
             class="profile-pic"
             id="profilePicture"
             onerror="this.src='{{ url_for('static', filename='uploads/profile_images/default.png') }}'">
        <span class="user-name">{{ user.full_name }}</span>
      </div>
      <button id="logoutBtn" class="logout-btn">Cerrar Sesi贸n</button>
    </div>
  </div>

  <div class="container">
    <div class="chat-wrapper">
      <div class="connection-section">
        <label>
          <span>Nombre:</span>
          <input id="username" value="{{ user.full_name }}" readonly />
        </label>
        <button id="btnConnect">Conectar</button>
      </div>

      <!-- rea de mensajes -->
      <div id="messages" class="messages-area" aria-live="polite"></div>

      <div id="controls">
        <input id="input" placeholder="Escribe un mensaje..." />
        <button id="send">Enviar</button>
        
        <!-- Bot贸n para subir im谩genes -->
        <input type="file" id="imageInput" accept="image/png, image/jpeg" style="display: none;"/>
        <button id="sendImageBtn">Subir Foto</button>
        
        <button id="getTime">Pedir hora</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='image_resizer.js') }}"></script>
  <script src="{{ url_for('static', filename='app.js') }}"></script>

  <script>
    // JavaScript para el bot贸n de cerrar sesi贸n
    document.getElementById('logoutBtn').addEventListener('click', function() {
      if (confirm('驴Est谩s seguro de que quieres cerrar sesi贸n?')) {
        window.location.href = "{{ url_for('auth_udg_bp.logout') }}";
      }
    });

    // Debug: mostrar informaci贸n del usuario en consola
    console.log(" Usuario en sesi贸n:", {
      name: "{{ user.full_name }}",
      email: "{{ user.email }}", 
      profileImage: "{{ user.profile_image }}"
    });
  </script>
</body>
</html>